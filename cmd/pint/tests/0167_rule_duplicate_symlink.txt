http response prometheus /*/api/v1/metadata 200 {"status":"success","data":{}}
http response prometheus /*/api/v1/status/config 200 {"status":"success","data":{"yaml":"global:\n  scrape_interval: 30s\n"}}
http response prometheus /*/api/v1/status/flags 200 {"status":"success","data":{"storage.tsdb.retention.time": "1d"}}
http response prometheus /*/api/v1/query_range 200 {"status":"success","data":{"resultType":"matrix","result":[]}}
http response prometheus /*/api/v1/query 200 {"status":"success","data":{"resultType":"vector","result":[]}}
http start prometheus 127.0.0.1:7167

mkdir testrepo
cd testrepo
exec git init --initial-branch=main .

cp ../src/v0.yml rules.yml
exec ln -s rules.yml symlink.yml
cp ../src/.pint.hcl .
env GIT_AUTHOR_NAME=pint
env GIT_AUTHOR_EMAIL=pint@example.com
env GIT_COMMITTER_NAME=pint
env GIT_COMMITTER_EMAIL=pint@example.com
exec git add .
exec git commit -am 'import rules and config'

exec git checkout -b v1
cp ../src/v1.yml rules.yml
exec git commit -am 'v1'
pint.ok --no-color ci
cmp stderr ../stderrV1.txt

-- stderrV1.txt --
level=INFO msg="Loading configuration file" path=.pint.hcl
level=INFO msg="Finding all rules to check on current git branch" base=main
level=WARN msg="Failed to parse file content" err="error at line 1: top level field must be a groups key, got string" path=.pint.hcl lines=1-20
level=INFO msg="Configured new Prometheus server" name=prom1 uris=1 uptime=up tags=[] include=["^rules.yml$"] exclude=[]
level=INFO msg="Configured new Prometheus server" name=prom2 uris=1 uptime=up tags=[] include=["^symlink.yml$"] exclude=[]
-- stderrV2.txt --
-- src/v0.yml --
groups:
- name: g1
  rules:
  - alert: DownAlert
    expr: up == 0
    annotations:
      summary: 'Service is down'
    labels:
      cluster: dev
  - record: up:sum
    expr: up == 0
    labels:
      cluster: dev
-- src/v1.yml --
groups:
- name: g1
  rules:
  - alert: DownAlert
    expr: up == 0
    annotations:
      summary: 'Service is down'
    labels:
      cluster: dev
  - record: new:sum
    expr: up == 0
  - record: up:sum
    expr: up == 0
    labels:
      cluster: dev
-- src/.pint.hcl --
ci {
  baseBranch = "main"
}
checks {
  disabled = [
    "promql/series",
  ]
}
prometheus "prom1" {
  uri      = "http://127.0.0.1:7167/1"
  timeout  = "5s"
  required = true
  include = ["rules.yml"]
}
prometheus "prom2" {
  uri      = "http://127.0.0.1:7167/2"
  timeout  = "5s"
  required = true
  include = ["symlink.yml"]
}
