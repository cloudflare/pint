
[TestAggregationCheck/Left_hand_side_of_AND_is_checked - 1]
- description: Left hand side of AND is checked
  content: |
    - record: foo
      expr: max (foo) without(job) AND on(instance) bar
  output: |
    2 |   expr: max (foo) without(job) AND on(instance) bar
                                  ^^^ `job` label is required and should be preserved when aggregating all rules.
                                      Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 19
          lastcolumn: 21
          kind: 0
        - message: Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 19
          lastcolumn: 21
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/Left_hand_side_of_AND_is_checked#01 - 1]
- description: Left hand side of AND is checked
  content: |-
    - record: foo
      expr: max (foo) by(instance) AND on(instance) bar
  output: |
    2 |   expr: max (foo) by(instance) AND on(instance) bar
                          ^^ `job` label is required and should be preserved when aggregating all rules.
                             Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 11
          lastcolumn: 12
          kind: 0
        - message: Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
          firstcolumn: 11
          lastcolumn: 12
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/Left_hand_side_of_group_left()_is_checked - 1]
- description: Left hand side of group_left() is checked
  content: |
    - record: foo
      expr: sum without(job) (foo) / on(type) group_left() sum without(job) (bar)
  output: |
    2 |   expr: sum without(job) (foo) / on(type) group_left() sum without(job) (bar)
                            ^^^ `job` label is required and should be preserved when aggregating all rules.
                                Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 13
          lastcolumn: 15
          kind: 0
        - message: Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 13
          lastcolumn: 15
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/Left_hand_side_of_group_left()_is_checked#01 - 1]
- description: Left hand side of group_left() is checked
  content: |-
    - record: foo
      expr: sum by(type) (foo) / on(type) group_left() sum by(job) (bar)
  output: |
    2 |   expr: sum by(type) (foo) / on(type) group_left() sum by(job) (bar)
                    ^^ `job` label is required and should be preserved when aggregating all rules.
                       Query is using aggregation with `by(type)`, only labels included inside `by(...)` will be present on the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 5
          lastcolumn: 6
          kind: 0
        - message: Query is using aggregation with `by(type)`, only labels included inside `by(...)` will be present on the results.
          firstcolumn: 5
          lastcolumn: 6
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/Left_hand_side_of_group_right()_is_ignored - 1]
[]

---

[TestAggregationCheck/Left_hand_side_of_group_right()_is_ignored#01 - 1]
[]

---

[TestAggregationCheck/Right_hand_side_of_AND_is_ignored - 1]
[]

---

[TestAggregationCheck/Right_hand_side_of_AND_is_ignored#01 - 1]
[]

---

[TestAggregationCheck/Right_hand_side_of_group_left()_is_ignored - 1]
[]

---

[TestAggregationCheck/Right_hand_side_of_group_left()_is_ignored#01 - 1]
[]

---

[TestAggregationCheck/Right_hand_side_of_group_right()_is_checked - 1]
- description: Right hand side of group_right() is checked
  content: |
    - record: foo
      expr: sum without(job) (foo) / on(type) group_right() sum without(job) (bar)
  output: |
    2 |   expr: sum without(job) (foo) / on(type) group_right() sum without(job) (bar)
                                                                            ^^^ `job` label is required and should be preserved when aggregating all rules.
                                                                                Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 61
          lastcolumn: 63
          kind: 0
        - message: Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 61
          lastcolumn: 63
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/Right_hand_side_of_group_right()_is_checked#01 - 1]
- description: Right hand side of group_right() is checked
  content: |-
    - record: foo
      expr: sum by(job) (foo) / on(type) group_right() sum by(type) (bar)
  output: |
    2 |   expr: sum by(job) (foo) / on(type) group_right() sum by(type) (bar)
                                                               ^^ `job` label is required and should be preserved when aggregating all rules.
                                                                  Query is using aggregation with `by(type)`, only labels included inside `by(...)` will be present on the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 48
          lastcolumn: 49
          kind: 0
        - message: Query is using aggregation with `by(type)`, only labels included inside `by(...)` will be present on the results.
          firstcolumn: 48
          lastcolumn: 49
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/ignores_rules_with_syntax_errors - 1]
[]

---

[TestAggregationCheck/ignores_rules_with_syntax_errors#01 - 1]
[]

---

[TestAggregationCheck/must_keep_job_label_/_bug - 1]
- description: must keep job label / bug
  content: |
    - record: foo
      expr: sum(foo) without(instance, job)
  output: |
    2 |   expr: sum(foo) without(instance, job)
                                           ^^^ `job` label is required and should be preserved when aggregating all rules.
                                               Query is using aggregation with `without(instance, job)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: 'Rule comment: some text'
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 28
          lastcolumn: 30
          kind: 0
        - message: Query is using aggregation with `without(instance, job)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 28
          lastcolumn: 30
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 2
    anchor: 0

---

[TestAggregationCheck/must_keep_job_label_/_bug#01 - 1]
- description: must keep job label / bug
  content: |
    - record: foo
      expr: sum(foo) by(instance)
  output: |
    2 |   expr: sum(foo) by(instance)
                         ^^ `job` label is required and should be preserved when aggregating all rules.
                            Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 10
          lastcolumn: 11
          kind: 0
        - message: Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
          firstcolumn: 10
          lastcolumn: 11
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 2
    anchor: 0

---

[TestAggregationCheck/must_keep_job_label_/_sum() - 1]
- description: must keep job label / sum()
  content: |
    - record: foo
      expr: sum(foo)
  output: |
    2 |   expr: sum(foo)
                ^^^ `job` label is required and should be preserved when aggregating all rules.
                    Query is using aggregation that removes all labels.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 1
          lastcolumn: 3
          kind: 0
        - message: Query is using aggregation that removes all labels.
          firstcolumn: 1
          lastcolumn: 3
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/must_keep_job_label_/_sum()_by() - 1]
- description: must keep job label / sum() by()
  content: |
    - record: foo
      expr: sum(foo) by()
  output: |
    2 |   expr: sum(foo) by()
                ^^^ `job` label is required and should be preserved when aggregating all rules.
                    Query is using aggregation that removes all labels.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 1
          lastcolumn: 3
          kind: 0
        - message: Query is using aggregation that removes all labels.
          firstcolumn: 1
          lastcolumn: 3
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/must_keep_job_label_/_warning - 1]
- description: must keep job label / warning
  content: |
    - record: foo
      expr: sum(foo) without(instance, job)
  output: |
    2 |   expr: sum(foo) without(instance, job)
                                           ^^^ `job` label is required and should be preserved when aggregating all rules.
                                               Query is using aggregation with `without(instance, job)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 28
          lastcolumn: 30
          kind: 0
        - message: Query is using aggregation with `without(instance, job)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 28
          lastcolumn: 30
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/must_keep_job_label_/_warning#01 - 1]
- description: must keep job label / warning
  content: |-
    - record: foo
      expr: sum(foo) by(instance)
  output: |
    2 |   expr: sum(foo) by(instance)
                         ^^ `job` label is required and should be preserved when aggregating all rules.
                            Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 10
          lastcolumn: 11
          kind: 0
        - message: Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
          firstcolumn: 10
          lastcolumn: 11
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/must_strip_job_label - 1]
- description: must strip job label
  content: |-
    - record: foo
      expr: sum(foo) without(instance)
  output: |
    2 |   expr: sum(foo) without(instance)
                         ^^^^^^^ `job` label should be removed when aggregating all rules.
  problem:
    reporter: promql/aggregate
    summary: label must be removed in aggregations
    details: ""
    diagnostics:
        - message: '`job` label should be removed when aggregating all rules.'
          firstcolumn: 10
          lastcolumn: 16
          kind: 0
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/must_strip_job_label#01 - 1]
- description: must strip job label
  content: |-
    - record: foo
      expr: sum(foo) by(job)
  output: |
    2 |   expr: sum(foo) by(job)
                            ^^^ `job` label should be removed when aggregating all rules.
  problem:
    reporter: promql/aggregate
    summary: label must be removed in aggregations
    details: ""
    diagnostics:
        - message: '`job` label should be removed when aggregating all rules.'
          firstcolumn: 13
          lastcolumn: 15
          kind: 0
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/must_strip_job_label_/_being_stripped - 1]
[]

---

[TestAggregationCheck/must_strip_job_label_/_being_stripped#01 - 1]
[]

---

[TestAggregationCheck/must_strip_job_label_/_empty_without - 1]
[]

---

[TestAggregationCheck/must_strip_job_label_/_sum()_without() - 1]
- description: must strip job label / sum() without()
  content: |
    - record: foo
      expr: sum(foo) without()
  output: |
    2 |   expr: sum(foo) without()
                ^^^^^^^^^^^^^^^^^^ `job` label should be removed when aggregating all rules.
  problem:
    reporter: promql/aggregate
    summary: label must be removed in aggregations
    details: ""
    diagnostics:
        - message: '`job` label should be removed when aggregating all rules.'
          firstcolumn: 1
          lastcolumn: 18
          kind: 0
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/name_must_match - 1]
[]

---

[TestAggregationCheck/name_must_match_/_recording - 1]
[]

---

[TestAggregationCheck/name_must_match__/alerting - 1]
[]

---

[TestAggregationCheck/nested_by(without()) - 1]
- description: nested by(without())
  content: |-
    - record: foo
      expr: sum(sum(foo) by(instance)) without(job)
  output: |
    2 |   expr: sum(sum(foo) by(instance)) without(job)
                                                   ^^^ `job` label is required and should be preserved when aggregating all rules.
                                                       Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 36
          lastcolumn: 38
          kind: 0
        - message: Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 36
          lastcolumn: 38
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/nested_by(without())#01 - 1]
- description: nested by(without())
  content: |
    - record: foo
      expr: sum(sum(foo) by(instance,job)) without(job)
  output: |
    2 |   expr: sum(sum(foo) by(instance,job)) without(job)
                                                       ^^^ `job` label is required and should be preserved when aggregating all rules.
                                                           Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 40
          lastcolumn: 42
          kind: 0
        - message: Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 40
          lastcolumn: 42
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/nested_by(without())#02 - 1]
- description: nested by(without())
  content: |-
    - record: foo
      expr: sum(sum(foo) by(instance)) without(instance)
  output: |
    2 |   expr: sum(sum(foo) by(instance)) without(instance)
                             ^^ `job` label is required and should be preserved when aggregating all rules.
                                Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 14
          lastcolumn: 15
          kind: 0
        - message: Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
          firstcolumn: 14
          lastcolumn: 15
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/nested_by(without())#03 - 1]
- description: nested by(without())
  content: |
    - record: foo
      expr: sum(sum(foo) by(instance)) without(job)
  output: |
    2 |   expr: sum(sum(foo) by(instance)) without(job)
                                ^^^^^^^^ `instance` label should be removed when aggregating all rules.
  problem:
    reporter: promql/aggregate
    summary: label must be removed in aggregations
    details: ""
    diagnostics:
        - message: '`instance` label should be removed when aggregating all rules.'
          firstcolumn: 17
          lastcolumn: 24
          kind: 0
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/nested_count - 1]
[]

---

[TestAggregationCheck/nested_count#01 - 1]
[]

---

[TestAggregationCheck/nested_count_AND_nested_count - 1]
[]

---

[TestAggregationCheck/nested_rule_must_keep_job_label - 1]
- description: nested rule must keep job label
  content: |-
    - record: foo
      expr: sum(sum(foo) without(job)) by(job)
  output: |
    2 |   expr: sum(sum(foo) without(job)) by(job)
                                     ^^^ `job` label is required and should be preserved when aggregating all rules.
                                         Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 22
          lastcolumn: 24
          kind: 0
        - message: Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 22
          lastcolumn: 24
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/nested_rule_must_keep_job_label#01 - 1]
- description: nested rule must keep job label
  content: |-
    - record: foo
      expr: sum(sum(foo) by(instance)) by(job)
  output: |
    2 |   expr: sum(sum(foo) by(instance)) by(job)
                             ^^ `job` label is required and should be preserved when aggregating all rules.
                                Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 14
          lastcolumn: 15
          kind: 0
        - message: Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
          firstcolumn: 14
          lastcolumn: 15
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/passing_most_outer_aggregation_should_continue_further_keep_checks - 1]
- description: passing most outer aggregation should continue further keep checks
  content: |
    - record: foo
      expr: sum(sum(foo) without(job)) without(instance)
  output: |
    2 |   expr: sum(sum(foo) without(job)) without(instance)
                                     ^^^ `job` label is required and should be preserved when aggregating all rules.
                                         Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 22
          lastcolumn: 24
          kind: 0
        - message: Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 22
          lastcolumn: 24
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/passing_most_outer_aggregation_should_stop_further_checks - 1]
- description: passing most outer aggregation should stop further checks
  content: |-
    - record: foo
      expr: sum(sum(foo) without(foo)) without(bar)
  output: |
    2 |   expr: sum(sum(foo) without(foo)) without(bar)
                             ^^^^^^^ `instance` label should be removed when aggregating all rules.
  problem:
    reporter: promql/aggregate
    summary: label must be removed in aggregations
    details: ""
    diagnostics:
        - message: '`instance` label should be removed when aggregating all rules.'
          firstcolumn: 14
          lastcolumn: 20
          kind: 0
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/passing_most_outer_aggregation_should_stop_further_strip_checks - 1]
[]

---

[TestAggregationCheck/uses_label_from_labels_map - 1]
[]

---

[TestAggregationCheck/uses_label_from_labels_map_/_alerting - 1]
[]

---

[TestAggregationCheck/uses_label_from_labels_map_/_recording - 1]
[]

---

[TestAggregationCheck/regex_keep:_job|instance_-_both_preserved - 1]
[]

---

[TestAggregationCheck/regex_keep:_job|instance_-_job_removed - 1]
- description: 'regex keep: job|instance - job removed'
  content: |
    - record: foo
      expr: sum(foo) without(job)
  output: |
    2 |   expr: sum(foo) without(job)
                                 ^^^ `job` label is required and should be preserved when aggregating all rules.
                                     Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 18
          lastcolumn: 20
          kind: 0
        - message: Query is using aggregation with `without(job)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 18
          lastcolumn: 20
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/regex_keep:_job|instance_-_instance_removed - 1]
- description: 'regex keep: job|instance - instance removed'
  content: |
    - record: foo
      expr: sum(foo) without(instance)
  output: |
    2 |   expr: sum(foo) without(instance)
                                 ^^^^^^^^ `instance` label is required and should be preserved when aggregating all rules.
                                          Query is using aggregation with `without(instance)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`instance` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 18
          lastcolumn: 25
          kind: 0
        - message: Query is using aggregation with `without(instance)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 18
          lastcolumn: 25
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/regex_keep:_job|instance_-_both_removed - 1]
- description: 'regex keep: job|instance - both removed'
  content: |
    - record: foo
      expr: sum(foo) without(job, instance)
  output: |
    2 |   expr: sum(foo) without(job, instance)
                                 ^^^ `job` label is required and should be preserved when aggregating all rules.
                                     Query is using aggregation with `without(job, instance)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`job` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 18
          lastcolumn: 20
          kind: 0
        - message: Query is using aggregation with `without(job, instance)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 18
          lastcolumn: 20
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0
- description: 'regex keep: job|instance - both removed'
  content: |
    - record: foo
      expr: sum(foo) without(job, instance)
  output: |
    2 |   expr: sum(foo) without(job, instance)
                                      ^^^^^^^^ `instance` label is required and should be preserved when aggregating all rules.
                                               Query is using aggregation with `without(job, instance)`, all labels included inside `without(...)` will be removed from the results.
  problem:
    reporter: promql/aggregate
    summary: required label is being removed via aggregation
    details: ""
    diagnostics:
        - message: '`instance` label is required and should be preserved when aggregating all rules.'
          firstcolumn: 23
          lastcolumn: 30
          kind: 0
        - message: Query is using aggregation with `without(job, instance)`, all labels included inside `without(...)` will be removed from the results.
          firstcolumn: 23
          lastcolumn: 30
          kind: 1
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/regex_strip:_job|instance_-_both_stripped - 1]
[]

---

[TestAggregationCheck/regex_strip:_job|instance_-_job_present - 1]
- description: 'regex strip: job|instance - job present'
  content: |
    - record: foo
      expr: sum(foo) by(job)
  output: |
    2 |   expr: sum(foo) by(job)
                            ^^^ `job` label should be removed when aggregating all rules.
  problem:
    reporter: promql/aggregate
    summary: label must be removed in aggregations
    details: ""
    diagnostics:
        - message: '`job` label should be removed when aggregating all rules.'
          firstcolumn: 13
          lastcolumn: 15
          kind: 0
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/regex_strip:_job|instance_-_instance_present - 1]
- description: 'regex strip: job|instance - instance present'
  content: |
    - record: foo
      expr: sum(foo) by(instance)
  output: |
    2 |   expr: sum(foo) by(instance)
                            ^^^^^^^^ `instance` label should be removed when aggregating all rules.
  problem:
    reporter: promql/aggregate
    summary: label must be removed in aggregations
    details: ""
    diagnostics:
        - message: '`instance` label should be removed when aggregating all rules.'
          firstcolumn: 13
          lastcolumn: 20
          kind: 0
    lines:
        first: 2
        last: 2
    severity: 1
    anchor: 0

---

[TestAggregationCheck/regex_strip:_job|instance_-_neither_present - 1]
[]

---

[TestAggregationCheck/regex_keep:_static_label_overrides_aggregation - 1]
[]

---
