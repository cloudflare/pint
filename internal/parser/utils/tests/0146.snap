
[TestLabelsSource/146 - 1]
expr: |4
    prometheus:scrape_series_added:since_gc:sum
    * on(prometheus) group_left()
    label_replace(
      max(max_over_time(go_memstats_alloc_bytes{job="prometheus"}[2h])) by(instance)
      /
      max(max_over_time(prometheus_tsdb_head_series[2h])) by(instance),
      "prometheus", "$1",
      "instance", "(.+)"
    )
output:
    - labels:
        prometheus:
            reason: Query is using many-to-one vector matching with `on(prometheus)`, labels included inside `on(...)` will be present on the results.
            fragment:
                start: 47
                end: 49
            kind: included
      operation: many-to-one
      isdeadreason: ""
      returns: vector
      joins:
        - labels:
            "":
                reason: Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
                fragment:
                    start: 158
                    end: 160
                kind: excluded
            __name__:
                reason: Aggregation removes metric name.
                fragment:
                    start: 92
                    end: 170
                kind: excluded
            instance:
                reason: Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
                fragment:
                    start: 158
                    end: 160
                kind: included
            job:
                reason: Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
                fragment:
                    start: 158
                    end: 160
                kind: excluded
            prometheus:
                reason: This label will be added to the result by label_replace() call.
                fragment:
                    start: 75
                    end: 287
                kind: guaranteed
          operation: label_replace
          isdeadreason: ""
          returns: vector
          joins:
            - labels:
                "":
                    reason: Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
                    fragment:
                        start: 229
                        end: 231
                    kind: excluded
                __name__:
                    reason: Aggregation removes metric name.
                    fragment:
                        start: 177
                        end: 241
                    kind: excluded
                instance:
                    reason: Query is using aggregation with `by(instance)`, only labels included inside `by(...)` will be present on the results.
                    fragment:
                        start: 229
                        end: 231
                    kind: included
              operation: max
              isdeadreason: ""
              returns: vector
              joins: []
              unless: []
              position:
                start: 195
                end: 226
              isdeadposition:
                start: 0
                end: 0
              returnednumber: 0
              type: 5
              fixedlabels: true
              isdead: false
              alwaysreturns: false
              knownreturn: false
              isconditional: false
              isreturnbool: false
          unless: []
          position:
            start: 92
            end: 241
          isdeadposition:
            start: 0
            end: 0
          returnednumber: 0
          type: 4
          fixedlabels: true
          isdead: false
          alwaysreturns: false
          knownreturn: false
          isconditional: false
          isreturnbool: false
      unless: []
      position:
        start: 1
        end: 44
      isdeadposition:
        start: 0
        end: 0
      returnednumber: 0
      type: 3
      fixedlabels: false
      isdead: false
      alwaysreturns: false
      knownreturn: false
      isconditional: false
      isreturnbool: false

---
